openapi: 3.0.3
info:
  title: Electrokerot Website API
  description:
    컴퓨터부품 (parts) / 견적서 (builds)
  contact:
    email: swimmingpolar@gmail.com
  version: 1.0.0
servers:
  - url: http://localhost:5611/v1
tags:
  - name: parts
    description: Computer component parts
  - name: builds
    description: User created computer build
  - name: posts
  - name: reviews
  - name: user
  - name: auth
paths:
  /parts/{ids}:
    get:
      tags:
        - parts
      summary: Get parts information of given ids
      operationId: getPartsByIds
      parameters:
        - name: ids
          in: path
          required: true
          schema:
            type: array
            items:
              type: string
              example: ObjectId
      responses:
        '200':
          description: Ok
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Part'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
  /parts/searchQueries:
    get:
      tags:
        - parts
      summary: Get a list of autocompleted queries
      operationId: getPartNamesByQuery
      parameters:
        - name: category
          in: query
          required: true
          schema:
            $ref: '#/components/schemas/Categories'
        - name: query
          in: query
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Ok
          content:
            application/json:
              schema:
                type: array
                items:
                  type: string
        '400':
          $ref: '#/components/responses/BadRequest'
  /parts/search:
    post:
      tags:
        - parts
      summary: Get search results
      operationId: getPartsByFilters
      requestBody:
        $ref: '#/components/requestBodies/PartSearch'
      responses:
        '200':
          description: Ok
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Part'
        '400':
          $ref: '#/components/responses/BadRequest'
  /parts:
    post:
      tags:
        - parts
      summary: Insert a part
      operationId: InsertPartByUrl
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                url:
                  type: string
                  format: uri
              required:
               - url
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Part'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
      security:
        - bearerAuth: []
  /builds:
    get:
      tags:
        - builds
      summary: Get a list of an user's builds
      operationId: getBuildById
      responses:
        '200':
          description: Ok
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Build'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
      security:
        - bearerAuth: []
    post:
      tags:
        - builds
      summary: Create a new build
      operationId: createBuild
      requestBody:
        $ref: '#/components/requestBodies/BuildCreate'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Build'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
      security:
        - bearerAuth: []
  /builds/{id}/clone:
    post:
      tags:
        - builds
      summary: Clone given build
      operationId: cloneBuildById
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            example: ObjectId
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Build'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
      security:
        - bearerAuth: []
  /builds/{id}:
    patch:
      tags:
        - builds
      summary: Update a build
      operationId: updateBuild
      requestBody:
        $ref: '#/components/requestBodies/BuildCreate'
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
            example: ObjectId
      responses:
        '204':
          $ref: '#/components/responses/NoContent'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
      security:
        - bearerAuth: []
    delete:
      tags:
        - builds
      summary: Delete a build
      operationId: deleteBuild
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            example: ObjectId
      responses:
        '204':
          $ref: '#/components/responses/NoContent'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
      security:
        - bearerAuth: []
  /user:
    get:
      tags:
        - user
      summary: Get the information of an user
      operationId: getUserById
      responses:
        '200':
          description: Ok
          content:
            application/json:
              schema:
                type: object
                properties:
                  email:
                    type: string
                    format: email
                  nickname:
                    type: string
        '401':
          $ref: '#/components/responses/Unauthorized'
      security:
        - bearerAuth: []
    post:
      tags:
        - user
      summary: Create an user
      operationId: registerUser
      requestBody:
        $ref: '#/components/requestBodies/UserSignup'
      responses:
        '201':
          $ref: '#/components/responses/Created'
        '400':
          $ref: '#/components/responses/BadRequest'
        '409':
          $ref: '#/components/responses/Conflict'
    patch:
      tags:
        - user
      summary: Update an user's profile
      operationId: updateUserProfile
      requestBody:
        $ref: '#/components/requestBodies/UserUpdateProfile'
      responses:
        '204':
          $ref: '#/components/responses/NoContent'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '409':
          $ref: '#/components/responses/Conflict'
      security:
        - bearerAuth: []
    delete:
      tags:
        - user
      summary: Delete user
      operationId: deleteUser
      responses:
        '204':
          $ref: '#/components/responses/NoContent'
        '401':
          $ref: '#/components/responses/Unauthorized'
      security:
        - bearerAuth: []
  /login:
    post:
      tags:
        - auth
      summary: Login
      operationId: login
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                  format: email
                password:
                  type: string
                  format: password
      responses:
        '204':
          description: No content
          headers:
            Authorization:
              schema:
                type: string
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
  /logout:
    get:
      tags:
        - auth
      summary: Logout
      operationId: logout
      responses:
        '204':
          $ref: '#/components/responses/NoContent'
        '401':
          $ref: '#/components/responses/Unauthorized'
      security:
        - bearerAuth: []
  /posts:
    get:
      tags:
        - posts
      summary: Get a list of posts
      operationId: getPostsByFilter
      parameters:
        - name: category
          in: query
          required: true
          schema:
            $ref: '#/components/schemas/PostCategory'
        - name: page
          in: query
          required: true
          schema:
            type: integer
            default: 1
            minimum: 1
            multipleOf: 1
        - name: title
          description: option#1 (only take single option)
          in: query
          schema:
            type: string
        - name: nickname
          description: option#2 (only take single option)
          in: query
          schema:
            type: string
        - name: build
          description: option#3 (only take single option)
          in: query
          explode: false
          schema:
            type: array
            items:
              type: string
              example: ObjectId
        - name: userId
          in: query
          description: option#4 (only take single option)
          schema:
            type: string
            example: ObjectId
      responses:
        '200':
          description: Ok
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Post'
        '400':
          $ref: '#/components/responses/BadRequest'
    post:
      tags:
        - posts
      summary: Create a post
      operationId: createPost
      requestBody:
        $ref: '#/components/requestBodies/PostCreate'
      responses:
        '201':
          $ref: '#/components/responses/Created'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
      security:
        - bearerAuth: []
  /posts/{id}:
    get:
      tags:
        - posts
      summary: Get a post
      operationId: getPostById
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            example: ObjectId
      responses:
        '200':
          description: Ok
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Post'
        '400':
          $ref: '#/components/responses/BadRequest'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
    patch:
      tags:
        - posts
      summary: Update post
      operationId: updatePost
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            example: ObjectId
      requestBody:
        $ref: '#/components/requestBodies/PostCreate'
      responses:
        '204':
          $ref: '#/components/responses/NoContent'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
      security:
        - bearerAuth: []
    delete:
      tags:
        - posts
      summary: Delete a post
      operationId: deletePostById
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            example: ObjectId
      responses:
        '204':
          $ref: '#/components/responses/NoContent'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
      security:
        - bearerAuth: []
  /posts/{id}/vote:
    post:
      tags:
        - posts
      summary: vote like/dislike on a post
      operationId: vote
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            example: ObjectId
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                action:
                  type: string
                  enum:
                    - like
                    - dislike
      responses:
        '204':
          $ref: '#/components/responses/NoContent'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
      security:
        - bearerAuth: []
  /posts/{id}/bookmark:
    post:
      tags:
        - posts
      summary: bookmark a post
      operationId: bookmark
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            example: ObjectId
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                action:
                  type: string
                  enum:
                    - bookmark
                    - unmark
      responses:
        '204':
          $ref: '#/components/responses/NoContent'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
      security:
        - bearerAuth: []
  /posts/{id}/comments:
    get:
      tags:
        - posts
      summary: Get a list of comments of given post
      operationId: getCommentsByPostId
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            example: ObjectId
        - name: page
          in: query
          required: true
          schema:
            type: integer
            default: 1
            minimum: 1
            multipleOf: 1
      responses:
        '200':
          description: Ok
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Comment'
        '400':
          $ref: '#/components/responses/BadRequest'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/BadRequest'
components:
  schemas:
    Part:
      type: object
      properties:
        _id:
          type: string
          example: ObjectId
        name:
          type: string
        category:
          type: string
        variants:
          type: array
          items:
            # $ref: '#/components/schemas/Part'
            # self-referencing (open api cannot render self referneces)
            # list of variants [Part, Part, ...]
            type: string
            example:
              SelfReferencingPartObjects
        details:
          type: object
          description: 제조사, 용량, 색상, ...
          additionalProperties:
            properties:
              type:
                type: string
              value:
                type: string
        vendors:
          type: array
          items:
            type: object
            properties:
              marketType:
                $ref: '#/components/schemas/MarketType'
              vendorsList:
                type: array
                items:
                  type: object
                  properties:
                    vendorName:
                      type: string
                    vendorCode:
                      type: string
                    url:
                      type: string
                      format: uri
        prices:
          type: array
          items:
            type: object
            properties:
              timestamp:
                type: string
                format: date-time
              value:
                type: string
        updatedAt:
          type: string
          format: date-time
    Build:
      type: object
      properties:
        _id:
          type: string
          example: ObjectId
        name:
          type: string
        isSelected:
          type: boolean
          default: false
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        parts:
          type: object
          description: cpu, mainboard, ...
          additionalProperties:
            properties:
              name:
                type: string
              count:
                type: integer
                default: 1
              price:
                type: string
              partId:
                type: string
                example: ObjectId
              filters:
                type: array
                items:
                  type: object
                  properties:
                    marketType:
                      type: string
                      enum:
                        - openMarket
                        - mall
                        - credit
                        - cash
                    vendorUrl:
                      type: string
                      format: uri
                    status:
                      type: string
                      enum:
                        - included
                        - selected
                        - excluded
        optimization:
          type: object
          properties:
            hash:
              type: string
              example: sha1 hash
            lowestPrice:
              type: object
              description: cpu, mainboard, ...
              additionalProperties:
                properties:
                  marketType:
                    $ref: '#/components/schemas/MarketType'
                  vendorUrl:
                    type: string
                    format: uri
            leastPackage:
              type: object
              description: cpu, mainboard, ...
              additionalProperties:
                properties:
                  marketType:
                    $ref: '#/components/schemas/MarketType'
                  vendorUrl:
                    type: string
                    format: uri
    Categories:
      type: string
      enum:
        - cpu
        - mainboard
        - memory
        - graphics
        - ssd
        - hdd
        - power
        - case
        - cooler
    MarketType:
      type: string
      enum:
        - openMarket
        - mall
        - credit
        - cash
    Post:
      type: object
      properties:
        _id:
          type: string
          example: ObjectId
        category:
          type: string
        owner:
          type: string
          example: ObjectId
        nickname:
          type: string
        title:
          type: string
        tag:
          type: string
        content:
          type: string
        builds:
          type: array
          items:
            type: object
            description: cpu, mainboard, ...
            additionalProperties:
              type: object
              properties:
                partId:
                  type: string
                  example: ObjectId
                count:
                  type: number
          example: builds[0], builds[1], ...
        likes:
          type: number
        comments:
          type: array
          items:
            $ref: '#/components/schemas/Comment'
        createdAt:
          type: string
          format: date-time
    PostCategory:
      type: string
      default: free
      enum:
        - free
    PostTag:
      type: string
      default: general
      enum:
        - general
        - question
        - build
    Comment:
      type: object
      properties:
        _id:
          type: string
          example: ObjectId
        owner:
          type: string
          example: ObjectId
        parent:
          type: string
          example: ObjectId
        nickname:
          type: string
        content:
          type: string
        likes:
          type: number
        indentation:
          type: number
        createdAt:
          type: string
          format: date-time
  requestBodies:
    PartSearch:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              category:
                $ref: '#/components/schemas/Categories'
              page:
                type: integer
                default: 1
                minimum: 1
                multipleOf: 1
              query:
                type: string
              filters:
                type: object
                description: 제조사, 용량, 색상, ...
                additionalProperties:
                  type: array
                  items:
                    type: string
            required:
              - category
              - page
    BuildCreate:
      content:
        application/json:
          schema:
            type: object
            properties:
              name:
                type: string
              isSelected:
                type: boolean
                default: false
              parts:
                type: object
                description: cpu, mainboard, ...
                additionalProperties:
                  properties:
                    name:
                      type: string
                    count:
                      type: integer
                      default: 1
                      minimum: 1
                      multipleOf: 1
                    price:
                      type: string
                    partId:
                      type: string
                      example: ObjectId
                    filters:
                      type: array
                      items:
                        type: object
                        properties:
                          marketType:
                            type: string
                            enum:
                              - openMarket
                              - mall
                              - credit
                              - cash
                          vendorUrl:
                            type: string
                            format: uri
                          status:
                            type: string
                            enum:
                              - included
                              - selected
                              - excluded
              optimization:
                type: object
                properties:
                  hash:
                    type: string
                    example: sha1 hash
                  lowestPrice:
                    type: object
                    description: cpu, mainboard, ...
                    additionalProperties:
                      properties:
                        marketType:
                          $ref: '#/components/schemas/MarketType'
                        vendorUrl:
                          type: string
                          format: uri
                  leastPackage:
                    type: object
                    description: cpu, mainboard, ...
                    additionalProperties:
                      properties:
                        marketType:
                          $ref: '#/components/schemas/MarketType'
                        vendorUrl:
                          type: string
                          format: uri
    UserSignup:
      content:
        application/json:
          schema:
            type: object
            properties:
              email:
                type: string
                format: email
              password:
                type: string
                format: password
              passwordConfirm:
                type: string
                format: password
              nickname:
                type: string
    UserUpdateProfile:
      content:
        application/json:
          schema:
            type: object
            properties:
              password:
                type: string
                format: password
              passwordConfirm:
                type: string
                format: password
              nickname:
                type: string
    PostCreate:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              category:
                $ref: '#/components/schemas/PostCategory'
              tag:
                $ref: '#/components/schemas/PostTag'
              title:
                type: string
              content:
                type: string
              builds:
                type: array
                items:
                  type: object
                  description: cpu, mainboard, ...
                  additionalProperties:
                    type: object
                    properties:
                      partId:
                        type: string
                        example: ObjectId
                      count:
                        type: integer
                        default: 1
                        minimum: 1
                        multipleOf: 1
            required:
              - category
              - tag
              - title
              - content
  responses:
    Created:
      description: Created
    NoContent:
      description: No content
    BadRequest:
      description: Bad request (resource validation failure)
    Unauthorized:
      description: Unauthorized access
    Forbidden:
      description: Request forbidden (access to unreachable resource, hit resource limitation)
    NotFound:
      description: Resource not found
    Conflict:
      description: Resource conflicts
    ServerError:
      description: Internal server error
    ServerBusy:
      description: Server is busy
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT